function rsort(e){return e.sort((e,s)=>s.datetime_created.localeCompare(e.datetime_created))}function setCookie(e=required(),s=required(),a=365){var t=new Date;t.setTime(t.getTime()+24*a*60*60*1e3),t.toUTCString(),document.cookie="sa-"+e+"="+s+";expires="+t+";path=/"}function getCookie(e=required()){var s="";return document.cookie.split(";").forEach(a=>{0==a.trim().indexOf(e)&&(s=a.trim().substring((e+"=").length))}),s}function required(){throw new Error("missing required parameter")}export default async function({addon:e,msg:s}){if(e.auth.isLoggedIn){var a=e.settings.get("alt_accs").split(/[^a-zA-Z0-9_-]+/);try{var t=JSON.parse(getCookie("sa-accounts"))}catch(e){t=[]}var c=[],o=[],r=[],i={name:[],token:[],id:[]};function l(){Object.keys(o).length==c.length&&(o=rsort(o.flat()),o.forEach(e=>document.getElementsByClassName("messages-social-list")[0].innerHTML+=`<li class="social-message mod-${m(e)}</div></div><span class="social-message-date"><span>${e.datetime_created}</span></span></div></li>`),document.querySelector(".messages-social-list .loading").outerHTML="")}function m(e){switch(e.type){case"followuser":return`follow-user"><div class="flex-row mod-social-message"><div class="social-message-content"><img alt="follow notification image" class="social-message-icon" src="/svgs/messages/follow.svg"><div><span><a class="social-messages-profile-link" href="/users/${e.actor_username}/">${e.actor_username}</a> is now following ${e.recipient_id}</span>`;case"loveproject":return`love-project"><div class="flex-row mod-social-message"><div class="social-message-content"><img alt="love notification image" class="social-message-icon" src="/svgs/messages/love.svg"><div><span><a class="social-messages-profile-link" href="/users/${e.actor_username}">${e.actor_username}</a> loved your project <a href="/projects/${e.project_id}">${e.title.replaceAll("<","&lt;").replaceAll(">","&gt;")}</a></span>`;case"favoriteproject":return`love-favorite"><div class="flex-row mod-social-message"><div class="social-message-content"><img alt="favorite notification image" class="social-message-icon" src="/svgs/messages/favorite.svg"><div><span><a class="social-messages-profile-link" href="/users/${e.actor_username}">${e.actor_username}</a> favorited your project <a href="/projects/${e.project_id}">${e.project_title.replaceAll("<","&lt;").replaceAll(">","&gt;")}</a></span>`;case"remixproject":return`remix-project"><div class="flex-row mod-social-message"><div class="social-message-content"><img alt="remix notification image" class="social-message-icon" src="/svgs/messages/remix.svg"><div><span><a class="social-messages-profile-link" href="/users/${e.actor_username}">${e.actor_username}</a> remixed your project <a href="/projects/${e.parent_id}">${e.parent_title.replaceAll("<","&lt;").replaceAll(">","&gt;")}</a> as <a href="/projects/${e.project_id}">${e.title.replaceAll("<","&lt;").replaceAll(">","&gt;")}</a></span>`;case"addcomment":if(c.flatMap(Object.values).includes(e.commentee_username))switch(e.comment_type){case 0:return`comment-message"><div class="flex-row mod-social-message"><div class="social-message-content"><img alt="comment notification image" class="social-message-icon" src="/svgs/messages/comment.svg"><div><p class="comment-message-info"><span><a class="social-messages-profile-link" href="/users/${e.actor_username}/">${e.actor_username}</a> replied to your comment on <a href="/projects/${e.comment_obj_id}/#comments-${e.comment_id}">${e.comment_obj_title.replaceAll("<","&lt;").replaceAll(">","&gt;")}</a></span></p><div class="flex-row mod-comment-message"><a href="/users/${e.actor_username}"><img alt="${e.actor_username}'s avatar" class="comment-message-info-img" src="https://cdn2.scratch.mit.edu/get_image/user/${e.actor_id}_32x32.png"></a><div class="comment-text"><p class="emoji-text mod-comment">${e.comment_fragment.replaceAll("<","&lt;").replaceAll(">","&gt;")}</p></div></div>`;case 1:return`comment-message"><div class="flex-row mod-social-message"><div class="social-message-content"><img alt="comment notification image" class="social-message-icon" src="/svgs/messages/comment.svg"><div><p class="comment-message-info"><span><a class="social-messages-profile-link" href="/users/${e.actor_username}/">${e.actor_username}</a> replied to your comment on <a href="/users/${e.comment_obj_id}/#comments-${e.comment_id}"><span>${e.comment_obj_title.replaceAll("<","&lt;").replaceAll(">","&gt;")}'s profile</span></a></span></p><div class="flex-row mod-comment-message"><a href="/users/${e.actor_username}"><img alt="${e.actor_username}'s avatar" class="comment-message-info-img" src="https://cdn2.scratch.mit.edu/get_image/user/${e.actor_id}_32x32.png"></a><div class="comment-text"><p class="emoji-text mod-comment">${e.comment_fragment.replaceAll("<","&lt;").replaceAll(">","&gt;")}</p></div></div>`;case 2:return`comment-message"><div class="flex-row mod-social-message"><div class="social-message-content"><img alt="comment notification image" class="social-message-icon" src="/svgs/messages/comment.svg"><div><p class="comment-message-info"><span><a class="social-messages-profile-link" href="/users/${e.actor_username}/">${e.actor_username}</a> replied to your comment in <a href="/studios/${e.comment_obj_id}/comments/#comments-${e.comment_id}">${e.comment_obj_title.replaceAll("<","&lt;").replaceAll(">","&gt;")}</a></span></p><div class="flex-row mod-comment-message"><a href="/users/${e.actor_username}"><img alt="${e.actor_username}'s avatar" class="comment-message-info-img" src="https://cdn2.scratch.mit.edu/get_image/user/${e.actor_id}_32x32.png"></a><div class="comment-text"><p class="emoji-text mod-comment">${e.comment_fragment.replaceAll("<","&lt;").replaceAll(">","&gt;")}</p></div></div>`;default:return`sa-error"><div class="flex-row mod-social-message"><div class="social-message-content"><img alt="notification image" src="//www.pikpng.com/pngl/b/131-1312304_attention-png.png" class="social-message-icon" width="1rem"><div><p class="comment-message-info"><span>Scratch Addons error: <code>Unrecognised comment type - ${e.comment_type}</code>. Please post this error on <a href="https://github.com/ScratchAddons/ScratchAddons/issues/new?assignees=RedGuy12&amp;labels=bug&amp;template=---bug.md&amp;title=Unrecognised%20comment%20type:%20${e.comment_type}">GitHub</a> or report it via <a href="https://scratchaddons.com/feedback">Scratch Addons Feedback</a>. Wherever you report it, please make sure you include the following error code: </span></p><div class="flex-row mod-sa-error"><div class="error-text"><pre class="sa-error">JSON message: ${JSON.stringify(e).replaceAll("<","&lt;").replaceAll(">","&gt;")}</pre></div></div>`}else switch(e.comment_type){case 0:return`comment-message"><div class="flex-row mod-social-message"><div class="social-message-content"><img alt="comment notification image" class="social-message-icon" src="/svgs/messages/comment.svg"><div><p class="comment-message-info"><span><a class="social-messages-profile-link" href="/users/${e.actor_username}/">${e.actor_username}</a> commented on <a href="/projects/${e.comment_obj_title.replaceAll("<","&lt;").replaceAll(">","&gt;")}/#comments-${e.comment_id}">${e.comment_obj_title.replaceAll("<","&lt;").replaceAll(">","&gt;")}</a></span></p><div class="flex-row mod-comment-message"><a href="/users/${e.actor_username}"><img alt="${e.actor_username}'s avatar" class="comment-message-info-img" src="https://cdn2.scratch.mit.edu/get_image/user/${e.actor_id}_32x32.png"></a><div class="comment-text"><p class="emoji-text mod-comment">${e.comment_fragment.replaceAll("<","&lt;").replaceAll(">","&gt;")}</p></div></div>`;case 1:return`comment-message"><div class="flex-row mod-social-message"><div class="social-message-content"><img alt="comment notification image" class="social-message-icon" src="/svgs/messages/comment.svg"><div><p class="comment-message-info"><span><a class="social-messages-profile-link" href="/users/${e.actor_username}/">${e.actor_username}</a> commented on <a href="/users/${e.comment_obj_title.replaceAll("<","&lt;").replaceAll(">","&gt;")}/#comments-${e.comment_id}">${e.comment_obj_title.replaceAll("<","&lt;").replaceAll(">","&gt;")}'s profile</a></span></p><div class="flex-row mod-comment-message"><a href="/users/${e.actor_username}"><img alt="${e.actor_username}'s avatar" class="comment-message-info-img" src="https://cdn2.scratch.mit.edu/get_image/user/${e.actor_id}_32x32.png"></a><div class="comment-text"><p class="emoji-text mod-comment">${e.comment_fragment.replaceAll("<","&lt;").replaceAll(">","&gt;")}</p></div></div>`;default:return`sa-error"><div class="flex-row mod-social-message"><div class="social-message-content"><img alt="notification image" src="//www.pikpng.com/pngl/b/131-1312304_attention-png.png" class="social-message-icon" width="1rem"><div><p class="comment-message-info"><span>Scratch Addons error: <code>Unrecognised comment type - ${e.comment_type}</code>. Please post this error on <a href="https://github.com/ScratchAddons/ScratchAddons/issues/new?assignees=RedGuy12&amp;labels=bug&amp;template=---bug.md&amp;title=Unrecognised%20comment%20type:%20${e.comment_type}">GitHub</a> or report it via <a href="https://scratchaddons.com/feedback">Scratch Addons Feedback</a>. Wherever you report it, please make sure you include the following error code: </span></p><div class="flex-row mod-sa-error"><div class="error-text"><pre class="sa-error">JSON message: ${JSON.stringify(e).replaceAll("<","&lt;").replaceAll(">","&gt;")}</pre></div></div>`}case"curatorinvite":return`curator-invite"><div class="flex-row mod-social-message"><div class="social-message-content"><img alt="curator invite notification image" class="social-message-icon" src="/svgs/messages/curator-invite.svg"><div><span><a class="social-messages-profile-link" href="/users/${e.actor_username}/">${e.actor_username}</a> invited <a class="social-messages-profile-link" href="/users/${e.recipient_name}/">${e.recipient_name}</a> to curate the studio <a href="/studios/${e.gallery_id}/">${e.title.replaceAll("<","&lt;").replaceAll(">","&gt;")}</a>. Visit the <a href="/studios/${e.gallery_id}/curators/">curator tab</a> on the studio to accept the invitation</span>`;case"becomeownerstudio":return`become-manager"><div class="flex-row mod-social-message"><div class="social-message-content"><img alt="become owner notification image" class="social-message-icon" src="/svgs/messages/owner-invite.svg"><div><span><a class="social-messages-profile-link" href="/users/${e.actor_username}/">${e.actor_username}</a> promoted <a class="social-messages-profile-link" href="/users/${e.actor_username}/">${e.recipient_username}</a> to manager for the studio <a href="/studios/${e.gallery_id}/">${e.gallery_title.replaceAll("<","&lt;").replaceAll(">","&gt;")}</a></span>`;case"studioactivity":return`studio-activity"><div class="flex-row mod-social-message"><div class="social-message-content"><img alt="studio activity notification image" class="social-message-icon" src="/svgs/messages/studio-activity.svg"><div><span>There was new activity in <a href="/studios/${e.gallery_id}/activity">${e.title.replaceAll("<","&lt;").replaceAll(">","&gt;")}</a> today</span>`;case"forumpost":return`forum-activity"><div class="flex-row mod-social-message"><div class="social-message-content"><img alt="forum activity notification image" class="social-message-icon" src="/svgs/messages/forum-activity.svg"><div><span>There are new posts in the forum thread: <a href="/discuss/topic/${e.topic_id}/unread/">${e.topic_title.replaceAll("<","&lt;").replaceAll(">","&gt;")}</a></span>`;case"userjoin":return`user-join"><div class="flex-row mod-social-message"><div class="social-message-content"><div><span>Welcome to Scratch, ${e.actor_username}! After you make projects and comments, you'll get messages about them here. Go <a href="/explore">Explore</a> or <a href="/projects/editor/?tutorial=getStarted">make a project</a>.</span>`;case"loginrequired":default:return`sa-error"><div class="flex-row mod-social-message"><div class="social-message-content"><img alt="notification image" src="//www.pikpng.com/pngl/b/131-1312304_attention-png.png" class="social-message-icon" width="1rem"><div><p class="comment-message-info"><span>Scratch Addons error: <code>Unrecognised message type - ${e.type}</code>. Please post this error on <a href="https://github.com/ScratchAddons/ScratchAddons/issues/new?assignees=RedGuy12&amp;labels=bug&amp;template=---bug.md&amp;title=Unrecognised%20message%20type:%20${e.type}">GitHub</a> or report it via <a href="https://scratchaddons.com/feedback">Scratch Addons Feedback</a>. Wherever you report it, please make sure you include the following error code: </span></p><div class="flex-row mod-sa-error"><div class="error-text"><pre class="sa-error">JSON message: ${JSON.stringify(e).replaceAll("<","&lt;").replaceAll(">","&gt;")}</pre></div></div>`}}t.forEach((e,s)=>{var a=Object.values(e),t=Object.keys(e);i.name[s]=t.indexOf("name")>-1?a[t.indexOf("name")]:"",i.token[s]=t.indexOf("token")>-1?a[t.indexOf("token")]:"",i.id[s]=t.indexOf("id")>-1?a[t.indexOf("id")]:""}),a.forEach((s,a)=>{c[a]={},c[a].name=s,s==e.auth.username?(c[a].token=e.auth.xToken,c[a].id=e.auth.userId):(c[a].token=i.token[i.name.indexOf(s)],c[a].id=i.id[i.name.indexOf(s)])}),setCookie("accounts",JSON.stringify(c)),document.querySelector(".messages-social-list").innerHTML='<img src="//cdn.scratch.mit.edu/scratchr2/static/__31603c47ef357e5c3cfbc182f95181bb__//images/ajax-loader.gif" class="loading" alt="loading...">',c.forEach((e,s)=>{r[s]=[],Object.values(e).includes("")?(o[s]=[{datetime_created:"2020-07-12T18:58:27.000Z",type:"loginrequired",recipient_id:e.id,recipient_name:e.name}],l()):fetch("https://api.scratch.mit.edu/users/"+e.name+"/messages?x-token="+e.token).then(e=>e.json()).then(a=>{o[s]=a,a.forEach((a,t)=>{o[s][t].recipient_id=e.id,o[s][t].recipient_name=e.name}),l()})})}}